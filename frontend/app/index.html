<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <style>
        :root {
            --sidebar-width: 80px;
            --primary-blue: #0d6efd;
            --sidebar-bg: #1a1a1a;
            --page-bg: #f0f2f5;
            --border-color: #dee2e6;
            --text-color: #212529;
            --text-muted: #6c757d;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--page-bg);
            color: var(--text-color);
        }
        
        .dashboard-container {
            display: flex;
            height: 100%;
        }

        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            z-index: 1000;
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        .sidebar-nav .nav-link {
            color: #a0a0a0;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 0;
            width: var(--sidebar-width);
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .sidebar-nav .nav-link i {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .sidebar-nav .nav-link:hover,
        .sidebar-nav .nav-link.active-link {
            background-color: var(--primary-blue);
            color: #ffffff;
        }

        .main-content {
            flex-grow: 1;
            padding: 0; /* Remove padding to allow pages to control it */
            overflow-y: auto;
            height: 100vh;
            box-sizing: border-box;
        }
        .page-content {
            display: none; 
            height: 100%;
        }

        .page-content.active {
            display: flex; /* Using flex for better child layout */
            flex-direction: column;
            height: 100%;
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li><a class="nav-link active-link" data-page="default_filter"><i class="fas fa-sliders-h"></i><span>Default Filter</span></a></li>
                    <li><a class="nav-link" data-page="dashboard"><i class="fas fa-th-large"></i><span>Dashboard</span></a></li>
                    <li><a class="nav-link" data-page="resources"><i class="fas fa-layer-group"></i><span>Resources</span></a></li>
                    <li><a class="nav-link" data-page="timeline"><i class="fas fa-stream"></i><span>Timeline</span></a></li>
                    <li><a class="nav-link" data-page="enforcement"><i class="fas fa-gavel"></i><span>Enforcement</span></a></li>
                    <li><a class="nav-link" data-page="notifications"><i class="fas fa-bell"></i><span>Notifications</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div id="default_filter" class="page-content active"></div>
            <div id="dashboard" class="page-content"></div>
            <div id="resources" class="page-content"></div>
            <div id="timeline" class="page-content"></div>
            <div id="enforcement" class="page-content"></div>
            <!-- Added a container for the notifications page which is also a modal -->
            <div id="notifications" class="page-content"></div> 
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page-content');
            
            async function loadPage(pageId, targetDiv) {
                // Only fetch content if the div is empty
                if (targetDiv && targetDiv.innerHTML.trim() === '') {
                    try {
                        const response = await fetch(`pages/${pageId}.html`);
                        if (!response.ok) {
                            throw new Error(`Could not load page: ${response.status}`);
                        }
                        const content = await response.text();
                        targetDiv.innerHTML = content;

                        // NEW LOGIC: If the page we just loaded is 'resources', run its specific JS now.
                        if (pageId === 'resources') {
                            const openBtn = document.querySelector('#tasks-tab-button');
                            const closeBtn = document.querySelector('#tasks-modal-close-btn');
                            const modal = document.querySelector('#tasks-upgrade-modal');

                            if (openBtn && closeBtn && modal) {
                                openBtn.onclick = function() {
                                    modal.style.display = 'flex';
                                };
                                closeBtn.onclick = function() {
                                    modal.style.display = 'none';
                                };
                                window.addEventListener('click', function(event) {
                                    if (event.target === modal) {
                                        modal.style.display = 'none';
                                    }
                                });
                            }
                        }
                        
                        // NEW LOGIC: If the page we just loaded is 'notifications', run its specific JS.
                        if (pageId === 'notifications') {
                            const modal = document.getElementById("upgradeModal");
                            const closeBtn = modal.querySelector(".modal-close");
                            if(modal) modal.style.display = 'flex';
                            if(closeBtn) closeBtn.onclick = () => { modal.style.display = 'none'; };
                        }

                    } catch (error) {
                        console.error("Failed to load page: ", error);
                        targetDiv.innerHTML = `<p style="color:red; text-align:center;">Failed to load content for ${pageId}.</p>`;
                    }
                } else if(pageId === 'notifications') {
                    // Special case for notifications: if content is already loaded, just re-show it.
                     const modal = document.getElementById("upgradeModal");
                     if(modal) modal.style.display = 'flex';
                }
            }
            
            function showPage(pageId) {
                // Do not hide the page content if a modal-like page is clicked
                if (pageId !== 'notifications') {
                    pages.forEach(page => page.classList.remove('active'));
                    const targetPage = document.getElementById(pageId);
                    if (targetPage) {
                        targetPage.classList.add('active');
                    }
                }
                
                // Update the active link in the sidebar
                navLinks.forEach(link => {
                    link.classList.toggle('active-link', link.dataset.page === pageId);
                });
            }

            navLinks.forEach(link => {
                link.addEventListener('click', async function (event) {
                    event.preventDefault();
                    const pageId = this.dataset.page;
                    const targetDiv = document.getElementById(pageId);
                    
                    await loadPage(pageId, targetDiv);
                    
                    // Only switch the main view if it's not a modal-like page
                     if (pageId !== 'notifications') {
                        showPage(pageId);
                    }
                });
            });
            
            // Load the default page on initial visit
            const initialLink = document.querySelector('.nav-link.active-link');
            if (initialLink) {
                const initialPageId = initialLink.dataset.page;
                const initialTargetDiv = document.getElementById(initialPageId);
                loadPage(initialPageId, initialTargetDiv);
            }
        });
    </script>

</body>
</html>